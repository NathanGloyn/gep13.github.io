
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Improve AppVeyor build times using build cache - gep13&#8217;s blog</title>
	<meta name="author" content="gep13">

	
	<meta name="description" content="Find out how to improve AppVeyor build times by making use of the build cache" />

	
	<meta name="keywords" content="AppVeyor, Build Cache, gems, Octopress" />

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/feed" rel="alternate" title="gep13's blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://www.gep13.co.uk/blog/improve-appveyor-build-times-using-build-cache/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!-- meta tags for twitter card -->

    <meta property="twitter:card" content="summary">
    <meta property="twitter:site" content="gep13">
    <meta property="twitter:url" content="http://www.gep13.co.uk/blog/improve-appveyor-build-times-using-build-cache/">
    <meta property="twitter:title" content="Improve AppVeyor build times using build cache">
    <meta property="twitter:description" content="Find out how to improve AppVeyor build times by making use of the build cache">


<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<link rel="stylesheet" type="text/css" href="http://assets.cookieconsent.silktide.com/current/style.min.css"/>
<script type="text/javascript" src="http://assets.cookieconsent.silktide.com/current/plugin.min.js"></script>
<script type="text/javascript">
	// <![CDATA[
		cc.initialise({
			cookies: {
				social: {
					title: 'Disqus et al.',
					description: 'Used for comments. You\'ll nee'+
							'd to log in to Disqus to leave'+
							' comments.'
				},
				analytics: {
					title: 'Analytics',
					description: 'Anonymously measure your use o'+
							'f this website to improve your'+
							' experience.'
				}
			},
			settings: {
				bannerPosition: "bottom",
				disableallsites: true
			}
		});
	// ]]>
</script>
<!-- End Cookie Consent plugin -->



<link rel="stylesheet" href="/ad-gallery/jquery.ad-gallery.css" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/ad-gallery/jquery.ad-gallery.js?rand=302"></script>
<script type="text/javascript">
$(function() {
  var galleries = $('.ad-gallery').adGallery({
    loader_image: '/ad-gallery/loader.gif',
    width: 640,
  });
})
</script>
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/adnuguk">ADNUGUK</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="facebook" href="http://www.facebook.com/gary.e.park" title="Facebook">Facebook</a>
		
		
		<a class="google" href="https://plus.google.com/+GaryEwanPark" rel="author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/gep13" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/gep13" title="GitHub">GitHub</a>
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/gep13">LinkedIn</a>
		
		
		
		<a class="delicious" href="http://delicious.com/gep13" title="Delicious">Delicious</a>
		
		
		
		<a class="rss" href="/feed" title="RSS">RSS</a>
		
	</div>
</nav>
<div class="profile-container">
  <div class="profilepic">
    <script src="/javascripts/md5.js"></script>
    <script type="text/javascript">
$(function(){
  $('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("gep13@gep13.co.uk") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
});
    </script>
  </div>
  <hgroup>
  <h1 class="site-title"><a href="/">gep13&#8217;s blog</a></h1>
  
  <p class="site-subtitle">Ramblings and Ponderings of a Microsoft Fan Boy&#8230;</p>
  
  </hgroup>
  
</div>
</header>
			</div>
		</div>
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="article-inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
   	<div class="meta"> 
 		<div class="date">








  


<time datetime="2014-10-20T00:00:00+00:00" data-updated="true" itemprop="datePublished">Oct 20th, 2014</time></div> 
 		<div class="tags">


	<a class='category' href='/blog/categories/appveyor/'>appveyor</a>


</div> 
 		 
 			<span class="comments"><a href="#disqus_thread">Comments</a></span> 
 		 
 	</div> 
	
	<h1 class="title" itemprop="name">Improve AppVeyor Build Times Using Build Cache</h1>
	<div class="entry-content" itemprop="articleBody"><h2>Take minutes off overall build time&hellip;</h2>

<p>By making use of the <a href="http://www.appveyor.com/docs/build-cache">build cache</a> within <a href="http://www.appveyor.com/">AppVeyor</a>.  For both this blog, and also the <a href="http://www.aberdeendevelopers.co.uk/">Aberdeen Developers .Net User Group</a> blog, I was able to reduce the overall build time by over 3 minutes.  Find out how.</p>

<!--more-->


<p>In a recent <a href="http://www.gep13.co.uk/blog/setup-appveyor-to-deploy-octopress-site-to-github-pages/">blog post</a>, I described how I was able to use AppVeyor to generate and then deploy an Octopress site to GitHub Pages.  The process is very simple to setup, the only slight downside is the time that it takes to generate the site itself, which can take over 7 minutes.</p>

<p>In the grand scheme of things, this isn&rsquo;t a long time, but if you are pushing a quick change, and want to see whether it worked before moving onto something else, these 7 minutes can seem like an entirity.  Looking at the build log, it was clear that the thing that was taking the longest was this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">cmd</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bundle install</span>
</span></code></pre></td></tr></table></div></figure>


<p>The reason that this is required is due to the fact that each time a build on AppVeyor runs, it is using a brand new instance of the <a href="http://www.appveyor.com/docs/installed-software">Build Worker Image</a>.  This is both good and bad.  It means that you are always starting from a known point.  However, it also means that anything you installed to get your build to work, is no longer there the next time the build runs.</p>

<p>In my case, there are almost 50 rubygems that need to be installed in order for Octopress to work correctly.  This means that these gems have to be downloaded from the internet, installed and verified, and then used in the build process.</p>

<p>Thankfully, AppVeyor has the concept of using a build cache.  This basically means that, once setup, AppVeyor will first extract all the cached files back onto the Build Worker Image, and then start the build proper.  As a result, when I run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">cmd</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bundle install</span>
</span></code></pre></td></tr></table></div></figure>


<p>The gems are already installed, and no longer need to be downloaded and installed.  Then, at the end of the build, the folders of interest are then re-cached, ready for extraction when the next build kicks off.</p>

<p><strong>NOTE:</strong> There is a limit of 100MB applied to the build cache.  If you are trying to cache more files than this, you will have to get in contact with AppVeyor support to see if there is anything that can be done to increase this number.</p>

<h2>Enough already, show me the configuration</h2>

<p>Setting this up is as simple as this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">cache</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">C:\Ruby193\lib\ruby\gems\1.9.1</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">C:\Ruby193\bin</span>
</span></code></pre></td></tr></table></div></figure>


<p>I originally started out trying to cache only the <code>gems</code> folder, however, with the help of Feodor Fitsner over at the <a href="http://help.appveyor.com/discussions/questions/585-what-setup-for-build-cache-is-require-for-bundle-install">AppVeyor Support</a> pages it became apparent that I would also need to include the <code>bin</code> folder, as during the installation of gems a number of them put their bash or CMD scripts into this folder so that they can make the tooling work correctly from the command line.</p>

<p>And there you have it!  With the build cache configured, I was able to reduce the build time for this blog from <code>5 min  37</code> to <code>2 min 28 sec</code>.  Not a bad effort!</p>

<p>This same approach can be used for other artefacts of a build process, for instance, restoring nuget packages.</p>
</div>

</article>

	<div class="share">
	<!-- Go to www.addthis.com/dashboard to customize your tools -->
	<div class="addthis_sharing_toolbox"></div>

	<!-- Go to www.addthis.com/dashboard to customize your tools -->
	<script type="text/plain" class="cc-onconsent-social" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-54075e8542beba4d"></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2016 - gep13 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<p>Theme: <a href="https://github.com/qingwang/octopress-theme-yinyang">YinYang</a></p>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/plain" class="cc-onconsent-social">
      var disqus_shortname = 'gep13';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.gep13.co.uk/blog/improve-appveyor-build-times-using-build-cache/';
        var disqus_url = 'http://www.gep13.co.uk/blog/improve-appveyor-build-times-using-build-cache/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/plain" class="cc-onconsent-analytics">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-20926037-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
